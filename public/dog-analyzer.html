<!DOCTYPE html>
<html>
  <head>
    <title>ê°•ì•„ì§€ ìŒì„± ê°ì • ë¶„ì„</title>
    <style>
      /* ê°„ë‹¨í•œ ìŠ¤íƒ€ì¼ë§ ì˜ˆì‹œ */
      .audio-analyzer-container {
        font-family: sans-serif;
        padding: 20px;
        border: 1px solid #ccc;
        border-radius: 8px;
        max-width: 500px;
        margin: 20px auto;
        background-color: #f9f9f9;
      }
      .audio-analyzer-container h3 {
        margin-top: 0;
        color: #333;
      }
      .audio-analyzer-container input[type="file"] {
        display: block;
        margin-bottom: 15px;
      }
      .audio-analyzer-container button {
        padding: 10px 15px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
      }
      .audio-analyzer-container button:hover {
        background-color: #0056b3;
      }
      .audio-analyzer-container button:disabled {
        background-color: #ccc;
        cursor: not-allowed;
      }
      #analyzer-status,
      #analyzer-result {
        margin-top: 15px;
        padding: 10px;
        border-radius: 4px;
      }
      #analyzer-status {
        background-color: #e9ecef;
        color: #495057;
      }
      #analyzer-result.success {
        background-color: #d4edda;
        color: #155724;
        border-color: #c3e6cb;
      }
      #analyzer-result.error {
        background-color: #f8d7da;
        color: #721c24;
        border-color: #f5c6cb;
      }
      .loader {
        border: 4px solid #f3f3f3; /* Light grey */
        border-top: 4px solid #3498db; /* Blue */
        border-radius: 50%;
        width: 20px;
        height: 20px;
        animation: spin 1s linear infinite;
        display: inline-block;
        margin-left: 10px;
        vertical-align: middle;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body>
    <div class="audio-analyzer-container" id="dog-analyzer">
      <h3>ê°•ì•„ì§€ ìŒì„± ê°ì • ë¶„ì„</h3>

      <div>
        <label for="dogAudioFile">ìŒì„± íŒŒì¼ ì„ íƒ (MP3, WAV ë“±):</label>
        <input
          type="file"
          id="dogAudioFile"
          name="audioFile"
          accept="audio/*"
        />
      </div>

      <div>
        <label for="dogUserToken">ì‚¬ìš©ì í† í° ì…ë ¥:</label>
        <input
          type="text"
          id="dogUserToken"
          name="userToken"
          value="imweb_test_dog_1"
          placeholder="ì˜ˆ: my_dog_token_123"
        />
        <small>ê° ì‚¬ìš©ìë¥¼ êµ¬ë¶„í•˜ê¸° ìœ„í•œ ê°’ì…ë‹ˆë‹¤.</small>
      </div>

      <button id="dogUploadButton">ì—…ë¡œë“œ ë° ë¶„ì„ ì‹œì‘</button>

      <div id="analyzer-status" style="display: none">ìƒíƒœ ë©”ì‹œì§€...</div>
      <div id="analyzer-result" style="display: none">ê²°ê³¼ í‘œì‹œ ì˜ì—­</div>
      <div
        id="debug-info"
        style="margin-top: 15px; font-size: 12px; color: #666"
      ></div>
      <div
        id="file-status"
        style="margin-top: 10px; font-size: 12px; color: blue"
      ></div>
    </div>

    <script>
      (function () {
        // ì „ì—­ ë³€ìˆ˜ë¥¼ í”¼í•˜ê¸° ìœ„í•´ ì¦‰ì‹œ ì‹¤í–‰ í•¨ìˆ˜ ì‚¬ìš©
        var _dogAnalyzer = {
          selectedFile: null,
          API_BASE_URL: "https://dog-talk-route.pages.dev/api/audio-analysis",
          MAX_FILE_SIZE: 10 * 1024 * 1024, // 10MB
          SUPPORTED_AUDIO_TYPES: [
            "audio/mpeg",
            "audio/wav",
            "audio/mp3",
            "audio/x-m4a",
            "audio/mp4",
            "audio/aac",
            "audio/ogg",
            "audio/webm",
            "audio/x-wav",
            "audio/wave",
          ],
          SUPPORTED_AUDIO_EXTENSIONS: [".mp3", ".wav", ".m4a", ".aac", ".ogg"],

          // ìš”ì†Œ ì°¸ì¡°
          elems: {
            container: document.getElementById("dog-analyzer"),
            uploadButton: document.getElementById("dogUploadButton"),
            audioFileInput: document.getElementById("dogAudioFile"),
            userTokenInput: document.getElementById("dogUserToken"),
            statusDiv: document.getElementById("analyzer-status"),
            resultDiv: document.getElementById("analyzer-result"),
            debugInfo: document.getElementById("debug-info"),
            fileStatus: document.getElementById("file-status"),
          },

          // ì´ˆê¸°í™” í•¨ìˆ˜
          init: function () {
            this.logDebug("ê°•ì•„ì§€ ë¶„ì„ê¸° ì´ˆê¸°í™” ì¤‘...");

            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
            if (this.elems.audioFileInput) {
              this.elems.audioFileInput.addEventListener(
                "change",
                this.handleFileSelect.bind(this)
              );
              this.logDebug("íŒŒì¼ ì„ íƒ ì´ë²¤íŠ¸ ë“±ë¡ë¨");
            }

            if (this.elems.uploadButton) {
              this.elems.uploadButton.addEventListener(
                "click",
                this.handleUpload.bind(this)
              );
              this.logDebug("ì—…ë¡œë“œ ë²„íŠ¼ ì´ë²¤íŠ¸ ë“±ë¡ë¨");
            }

            this.logDebug("ê°•ì•„ì§€ ë¶„ì„ê¸° ì´ˆê¸°í™” ì™„ë£Œ. íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
          },

          // ë””ë²„ê·¸ ë¡œê¹… í•¨ìˆ˜
          logDebug: function (message) {
            console.log("[ê°•ì•„ì§€ ë¶„ì„ê¸°]", message);
            if (this.elems.debugInfo) {
              this.elems.debugInfo.innerHTML = message;
              this.elems.debugInfo.style.display = "block";
            }
          },

          // íŒŒì¼ ìƒíƒœ í‘œì‹œ í•¨ìˆ˜
          showFileStatus: function (message, isError) {
            if (this.elems.fileStatus) {
              this.elems.fileStatus.innerHTML = message;
              this.elems.fileStatus.style.color = isError ? "red" : "blue";
              this.elems.fileStatus.style.display = "block";
            }
          },

          // ìƒíƒœ í‘œì‹œ í•¨ìˆ˜
          showStatus: function (message, isLoading) {
            if (this.elems.statusDiv) {
              this.elems.statusDiv.textContent = message;
              this.elems.statusDiv.innerHTML = message;

              if (isLoading) {
                var loader = document.createElement("div");
                loader.className = "loader";
                this.elems.statusDiv.appendChild(loader);
              }

              this.elems.statusDiv.style.display = "block";
            }
          },

          hideStatus: function () {
            if (this.elems.statusDiv) {
              this.elems.statusDiv.style.display = "none";
              this.elems.statusDiv.textContent = "";
              this.elems.statusDiv.innerHTML = "";
            }
          },

          showResult: function (message, isSuccess) {
            if (this.elems.resultDiv) {
              this.elems.resultDiv.textContent = message;
              this.elems.resultDiv.className = isSuccess ? "success" : "error";
              this.elems.resultDiv.style.display = "block";
            }
          },

          hideResult: function () {
            if (this.elems.resultDiv) {
              this.elems.resultDiv.style.display = "none";
              this.elems.resultDiv.textContent = "";
            }
          },

          // íŒŒì¼ ì„ íƒ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
          handleFileSelect: function (event) {
            try {
              this.logDebug("íŒŒì¼ ì„ íƒ ì´ë²¤íŠ¸ ë°œìƒ");

              // íŒŒì¼ì´ ì„ íƒë˜ì§€ ì•Šì•˜ë‹¤ë©´ ì´ˆê¸°í™”
              if (!event.target.files || event.target.files.length === 0) {
                this.logDebug("íŒŒì¼ì´ ì„ íƒë˜ì§€ ì•ŠìŒ");
                this.selectedFile = null;
                this.showFileStatus("íŒŒì¼ì´ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.", true);
                this.hideStatus();
                return;
              }

              var file = event.target.files[0];
              this.logDebug(
                "ì„ íƒëœ íŒŒì¼: " + file.name + ", í¬ê¸°: " + file.size + " bytes"
              );

              // íŒŒì¼ ìœ íš¨ì„± ê²€ì‚¬
              if (file.size > this.MAX_FILE_SIZE) {
                var errorMsg =
                  "íŒŒì¼ í¬ê¸°ê°€ ë„ˆë¬´ í½ë‹ˆë‹¤. ìµœëŒ€ " +
                  this.MAX_FILE_SIZE / (1024 * 1024) +
                  "MBê¹Œì§€ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.";
                this.showFileStatus(errorMsg, true);
                throw new Error(errorMsg);
              }

              var fileName = file.name.toLowerCase();
              var fileExtension = fileName.substring(fileName.lastIndexOf("."));

              // í™•ì¥ì í™•ì¸
              var isValidExtension = false;
              for (var i = 0; i < this.SUPPORTED_AUDIO_EXTENSIONS.length; i++) {
                if (fileName.endsWith(this.SUPPORTED_AUDIO_EXTENSIONS[i])) {
                  isValidExtension = true;
                  break;
                }
              }

              if (!isValidExtension) {
                var extErrorMsg =
                  "ì§€ì›ë˜ì§€ ì•ŠëŠ” íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤. ì§€ì›ë˜ëŠ” í˜•ì‹: MP3, WAV, M4A, AAC, OGG";
                this.showFileStatus(extErrorMsg, true);
                throw new Error(extErrorMsg);
              }

              // íŒŒì¼ ìœ íš¨ì„± ê²€ì‚¬ í†µê³¼
              this.selectedFile = file;
              var successMsg =
                "íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤: " +
                file.name +
                " (" +
                (file.size / (1024 * 1024)).toFixed(2) +
                "MB)";
              this.showFileStatus(successMsg);
              this.logDebug(
                "íŒŒì¼ ì„ íƒ ì„±ê³µ. selectedFile ì„¤ì •ë¨: " + file.name
              );

              // ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ
              this.showStatus(
                "ì„ íƒëœ íŒŒì¼: " +
                  file.name +
                  " (" +
                  (file.size / (1024 * 1024)).toFixed(2) +
                  "MB)",
                false
              );
              this.hideResult();
            } catch (error) {
              console.error("íŒŒì¼ ì„ íƒ ì˜¤ë¥˜:", error);
              this.selectedFile = null;
              this.showResult(error.message, false);
              this.logDebug("íŒŒì¼ ì„ íƒ ì˜¤ë¥˜: " + error.message);
              event.target.value = ""; // íŒŒì¼ ì„ íƒ ì´ˆê¸°í™”
            }
          },

          // ì—…ë¡œë“œ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
          handleUpload: function () {
            var self = this;

            try {
              this.logDebug(
                "ì—…ë¡œë“œ ë²„íŠ¼ í´ë¦­ë¨. selectedFile: " +
                  (this.selectedFile ? this.selectedFile.name : "null")
              );

              // íŒŒì¼ì´ ì„ íƒë˜ì§€ ì•Šì•˜ìœ¼ë©´ ì—ëŸ¬
              if (!this.selectedFile) {
                this.showFileStatus(
                  "íŒŒì¼ì´ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì˜¤ë””ì˜¤ íŒŒì¼ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.",
                  true
                );
                throw new Error(
                  "íŒŒì¼ì´ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì˜¤ë””ì˜¤ íŒŒì¼ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”."
                );
              }

              var token = this.elems.userTokenInput
                ? this.elems.userTokenInput.value.trim()
                : "";

              // í† í° ê²€ì¦
              if (!token || token.trim().length === 0) {
                throw new Error("ì‚¬ìš©ì í† í°ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
              }

              // UI ìƒíƒœ ì—…ë°ì´íŠ¸
              this.hideResult();
              this.showStatus("íŒŒì¼ ì—…ë¡œë“œ ë° ë¶„ì„ ìš”ì²­ ì¤‘...", true);

              if (this.elems.uploadButton) {
                this.elems.uploadButton.disabled = true;
              }

              // API ìš”ì²­
              this.uploadAndAnalyze(this.selectedFile, token)
                .then(function (jobId) {
                  self.showStatus(
                    "ìš”ì²­ ì„±ê³µ! Job ID: " +
                      jobId.substring(0, 10) +
                      "... ë¶„ì„ ê²°ê³¼ í™•ì¸ì„ ì‹œì‘í•©ë‹ˆë‹¤.",
                    true
                  );

                  // í´ë§ ì‹œì‘
                  return self.pollForResult(jobId, token);
                })
                .catch(function (error) {
                  console.error("ì˜¤ë¥˜ ë°œìƒ:", error);
                  self.hideStatus();
                  self.showResult("ì˜¤ë¥˜ ë°œìƒ: " + error.message, false);
                  self.logDebug("ì²˜ë¦¬ ì˜¤ë¥˜: " + error.message);
                })
                .finally(function () {
                  if (self.elems.uploadButton) {
                    self.elems.uploadButton.disabled = false;
                  }
                });
            } catch (error) {
              console.error("ì—…ë¡œë“œ ì˜¤ë¥˜:", error);
              this.hideStatus();
              this.showResult("ì˜¤ë¥˜ ë°œìƒ: " + error.message, false);
              this.logDebug("ì—…ë¡œë“œ ì˜¤ë¥˜: " + error.message);

              if (this.elems.uploadButton) {
                this.elems.uploadButton.disabled = false;
              }
            }
          },

          // API ìš”ì²­ í•¨ìˆ˜
          uploadAndAnalyze: function (file, token) {
            var self = this;

            return new Promise(function (resolve, reject) {
              try {
                self.logDebug("API ìš”ì²­ ì‹œì‘: " + self.API_BASE_URL);

                var formData = new FormData();
                formData.append("audio_file", file);
                formData.append("user_token", token);

                var xhr = new XMLHttpRequest();
                xhr.open("POST", self.API_BASE_URL, true);
                xhr.timeout = 15000; // 15ì´ˆ íƒ€ì„ì•„ì›ƒ
                xhr.withCredentials = true;

                xhr.onload = function () {
                  if (xhr.status >= 200 && xhr.status < 300) {
                    try {
                      var response = JSON.parse(xhr.responseText);
                      self.logDebug(
                        "API ì‘ë‹µ ë°›ìŒ: " +
                          JSON.stringify(response).substring(0, 100)
                      );

                      if (!response.success || !response.jobId) {
                        reject(
                          new Error(
                            response.message ||
                              "ì„œë²„ì—ì„œ ì‘ì—…ì„ ì‹œì‘í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤."
                          )
                        );
                      } else {
                        resolve(response.jobId);
                      }
                    } catch (parseError) {
                      reject(
                        new Error(
                          "ì„œë²„ ì‘ë‹µì„ íŒŒì‹±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤: " +
                            parseError.message
                        )
                      );
                    }
                  } else {
                    reject(new Error("HTTP ì˜¤ë¥˜: " + xhr.status));
                  }
                };

                xhr.onerror = function () {
                  reject(new Error("ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."));
                };

                xhr.ontimeout = function () {
                  reject(new Error("ìš”ì²­ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤."));
                };

                xhr.send(formData);
              } catch (error) {
                self.logDebug("API ìš”ì²­ ì˜¤ë¥˜: " + error.message);
                reject(error);
              }
            });
          },

          // ê°ì • í…ìŠ¤íŠ¸ ë³€í™˜ í•¨ìˆ˜
          getEmotionText: function (ansDogCode) {
            var emotionMap = {
              dog_1: "ì—ë„ˆìì´ì € ğŸ¶âš¡",
              dog_2: "ìš”êµ¬ ì¤‘ ğŸ™‹",
              dog_3: "í™”ë‚¨ ğŸ˜¡",
              dog_4: "ë°©ì–´ì  ğŸ›¡ï¸",
              dog_5: "ì£¼ëª©! ğŸ‘€",
              dog_6: "ì™¸ë¡œì›€ ğŸ¥º",
              dog_7: "ìˆ˜ë‹¤ìŸì´ ğŸ—£ï¸",
              dog_8: "ì•„í”” ğŸ¤•",
            };
            return (
              emotionMap[ansDogCode] || ansDogCode || "ì•Œ ìˆ˜ ì—†ëŠ” ê°ì • ì½”ë“œ"
            );
          },

          // ê²°ê³¼ í´ë§ í•¨ìˆ˜
          pollForResult: function (jobId, userToken, maxRetries, interval) {
            var self = this;
            maxRetries = maxRetries || 60; // 30ì—ì„œ 60ìœ¼ë¡œ ì¦ê°€
            interval = interval || 5000; // 2500msì—ì„œ 5000msë¡œ ì¦ê°€ (5ì´ˆ)
            var totalTimeout = (maxRetries * interval) / 1000; // ì „ì²´ ëŒ€ê¸° ì‹œê°„(ì´ˆ)

            self.showStatus(
              "ë¶„ì„ ê²°ê³¼ í™•ì¸ ì¤‘... (Job ID: " +
                jobId.substring(0, 10) +
                "...) ìµœëŒ€ " +
                Math.round(totalTimeout / 60) +
                "ë¶„ ì†Œìš”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
              true
            );

            var pollUrl =
              self.API_BASE_URL +
              "?jobId=" +
              encodeURIComponent(jobId) +
              "&userToken=" +
              encodeURIComponent(userToken);
            self.logDebug("í´ë§ ì‹œì‘, URL: " + pollUrl);

            return new Promise(function (resolve, reject) {
              var pollAttempt = 0;

              function poll() {
                if (pollAttempt >= maxRetries) {
                  self.hideStatus();
                  self.showResult(
                    "ë¶„ì„ ì‹œê°„ì´ ë„ˆë¬´ ì˜¤ë˜ ê±¸ë¦½ë‹ˆë‹¤. ì„œë²„ ë¬¸ì œê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‚˜ì¤‘ì— ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”. (ì•½ " +
                      Math.round(totalTimeout / 60) +
                      "ë¶„ ê²½ê³¼)",
                    false
                  );
                  reject(
                    new Error(
                      "ìµœëŒ€ ì‹œë„ íšŸìˆ˜ ì´ˆê³¼ (" +
                        maxRetries +
                        "íšŒ, " +
                        Math.round(totalTimeout / 60) +
                        "ë¶„)"
                    )
                  );
                  return;
                }

                pollAttempt++;

                var xhr = new XMLHttpRequest();
                xhr.open("GET", pollUrl, true);
                xhr.timeout = 10000; // 10ì´ˆ íƒ€ì„ì•„ì›ƒ
                xhr.withCredentials = true;

                xhr.onload = function () {
                  if (xhr.status >= 200 && xhr.status < 300) {
                    try {
                      var response = JSON.parse(xhr.responseText);
                      self.logDebug(
                        "í´ë§ ì‘ë‹µ ë°›ìŒ " +
                          pollAttempt +
                          "ë²ˆì§¸: " +
                          JSON.stringify(response).substring(0, 100)
                      );

                      if (response.success && response.status === "COMPLETED") {
                        self.hideStatus();
                        var result = response.result;
                        var resultMessage =
                          "ë¶„ì„ ì™„ë£Œ!\níŒŒì¼ëª…: " +
                          (result.fileNameOrigin || "N/A") +
                          "\n";

                        if (result.ansFilter === "noise") {
                          resultMessage +=
                            "ê²°ê³¼: ì£¼ë³€ ì†ŒìŒì´ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ë¥¸ íŒŒì¼ì„ ì‹œë„í•´ ë³´ì„¸ìš”.";
                        } else if (result.ansDog) {
                          resultMessage +=
                            "ê°ì •: " + self.getEmotionText(result.ansDog);
                        } else {
                          resultMessage += "ê²°ê³¼: ê°ì •ì„ íŠ¹ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
                        }

                        self.showResult(resultMessage, true);
                        resolve(response);
                        return;
                      } else if (
                        response.success &&
                        response.status === "PROCESSING"
                      ) {
                        // ì‹œë„ íšŸìˆ˜ì— ë”°ë¼ ì§„í–‰ë¥  ê³„ì‚°
                        var progressPercent = Math.min(
                          Math.round((pollAttempt / maxRetries) * 100),
                          95
                        );
                        var remainingTime = Math.round(
                          ((maxRetries - pollAttempt) * interval) / 1000
                        );

                        self.showStatus(
                          "ë¶„ì„ ì§„í–‰ ì¤‘... ì•½ " +
                            progressPercent +
                            "% ì™„ë£Œ" +
                            " (ë‚¨ì€ ì˜ˆìƒ ì‹œê°„: ì•½ " +
                            (remainingTime > 60
                              ? Math.ceil(remainingTime / 60) + "ë¶„"
                              : remainingTime + "ì´ˆ") +
                            ")",
                          true
                        );
                        setTimeout(poll, interval);
                      } else if (
                        response.success &&
                        response.status === "NO_CONTENT"
                      ) {
                        self.hideStatus();
                        self.showResult(
                          "ë¶„ì„ ê²°ê³¼ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ìŒì„± íŒŒì¼ì„ ì‚¬ìš©í•´ë³´ì„¸ìš”.",
                          false
                        );
                        resolve(response);
                        return;
                      } else {
                        self.showStatus(
                          "ê²°ê³¼ í™•ì¸ ì¤‘... (" +
                            pollAttempt +
                            "/" +
                            maxRetries +
                            "): " +
                            (response.message || "ì²˜ë¦¬ ì¤‘..."),
                          true
                        );
                        setTimeout(poll, interval);
                      }
                    } catch (parseError) {
                      self.showStatus(
                        "ì‘ë‹µ íŒŒì‹± ì˜¤ë¥˜ (" +
                          pollAttempt +
                          "/" +
                          maxRetries +
                          "): " +
                          parseError.message,
                        true
                      );
                      setTimeout(poll, interval);
                    }
                  } else {
                    self.showStatus(
                      "HTTP ì˜¤ë¥˜ (" +
                        pollAttempt +
                        "/" +
                        maxRetries +
                        "): " +
                        xhr.status,
                      true
                    );
                    setTimeout(poll, interval);
                  }
                };

                xhr.onerror = function () {
                  self.showStatus(
                    "ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë°œìƒ (" +
                      pollAttempt +
                      "/" +
                      maxRetries +
                      "), ì¬ì‹œë„ ì¤‘...",
                    true
                  );
                  setTimeout(poll, interval);
                };

                xhr.ontimeout = function () {
                  self.showStatus(
                    "ìš”ì²­ ì‹œê°„ ì´ˆê³¼ (" +
                      pollAttempt +
                      "/" +
                      maxRetries +
                      "), ì¬ì‹œë„ ì¤‘...",
                    true
                  );
                  setTimeout(poll, interval);
                };

                xhr.send();
              }

              // ì²« ë²ˆì§¸ í´ë§ ì‹œì‘
              poll();
            });
          },
        };

        // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ ì‹œ ì´ˆê¸°í™”
        if (document.readyState === "complete") {
          _dogAnalyzer.init();
        } else {
          window.addEventListener("load", function () {
            _dogAnalyzer.init();
          });
        }
      })();
    </script>
  </body>
</html>
